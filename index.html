// Project: Impressive-Data-Site
// Drop your CSV into /public/data.csv and your program into /src/utils/userProgram.js
// This single-file project scaffold contains multiple files separated by comments.

/* =======================
   file: package.json
   ======================= */
{
  "name": "impressive-data-site",
  "version": "1.0.0",
  "private": true,
  "dependencies": {
    "react": "^18.2.0",
    "react-dom": "^18.2.0",
    "papaparse": "^5.4.1",
    "recharts": "^2.6.2",
    "react-globe.gl": "^2.9.6",
    "three": "^0.155.0",
    "framer-motion": "^10.12.0",
    "lucide-react": "^0.269.0",
    "@shadcn/ui": "^0.1.0",
    "clsx": "^1.2.1"
  },
  "scripts": {
    "start": "vite",
    "build": "vite build",
    "preview": "vite preview"
  },
  "devDependencies": {
    "vite": "^5.0.0",
    "@vitejs/plugin-react": "^4.0.0",
    "tailwindcss": "^4.0.0",
    "postcss": "^8.4.0",
    "autoprefixer": "^10.4.0"
  }
}

/* =======================
   file: README.md
   ======================= */
# Impressive Data Site

Drop your CSV into `public/data.csv` (or change the path in `src/App.jsx`).
Drop your existing program as `src/utils/userProgram.js` — it should export a default async function `analyze(data)` that accepts the parsed CSV array and returns objects used for visualizations. The scaffold will import and call it at runtime.

Commands:

```
npm install
npm run dev
```

Deploy: push to GitHub, connect to Vercel or Netlify.


/* =======================
   file: public/data.csv
   ======================= */
country,major_area,region,year 2017,year 2018,year 2019,year 2020,year 2021,year 2022,year 2023,year 2024
Afghanistan,Asia,Southern Asia,null,null,6.49,8.2,9.23,1.9,2.84,3.63
Albania,Europe,Southern Europe,11.48,14.71,28.61,37.11,41.47,33.67,46.47,62.71
Algeria,Africa,Northern Africa,3.98,3.52,4.06,3.92,9.95,10.84,11.3,14.26
Andorra,Europe,Southern Europe,null,null,110.34,129.69,145.18,85.92,93.94,null
Angola,Africa,Middle Africa,null,12.76,13.74,14.77,15.04,12.84,15.96,18.58
Antigua and Barbuda,Latin America and the Caribbean,Caribbean,null,null,14.29,16.85,17.11,20.85,34.27,40.58
Argentina,Latin America and the Caribbean,South America,14.98,20.84,31.15,44.28,57.49,47.19,68.66,88.03
Armenia,Asia,Western Asia,24.61,21.01,24.06,30.49,37.21,36.27,44.96,56.54
Australia,Oceania,Australia and New Zealand,25.52,32.25,41.31,54.55,85.57,52.62,54.08,71.87
Austria,Europe,Western Europe,29.5,36.71,39.73,80.03,93.77,62.74,69.6,92.86
Azerbaijan,Asia,Western Asia,10.2,13.29,16.46,22.29,25.36,22.15,28.7,45.47
Bahamas,Latin America and the Caribbean,Caribbean,23.76,22.24,30.74,41.69,55.89,41.64,55,63.11
Bahrain,Asia,Western Asia,16.18,17,40.93,null,74.21,48.58,80.03,84.66
Bangladesh,Asia,Southern Asia,16.68,17.39,23.5,29.06,38.98,32.99,39.23,48.14
Barbados,Latin America and the Caribbean,Caribbean,45.02,72.24,84.2,95.36,110.25,81.29,94.66,99.09
Belarus,Europe,Eastern Europe,26.32,34.67,49.94,70.84,68.84,51.3,51.76,61.05
Belgium,Europe,Western Europe,53.95,59.35,70.04,95.9,121.81,83.63,91.35,100.82
Belize,Latin America and the Caribbean,Central America,7.62,12.44,29.56,37.39,41.45,40.65,43.13,44.74
Benin,Africa,Western Africa,null,null,8.05,10.24,16.81,14.77,24.31,22.48
Bermuda,Northern America,Northern America,18.39,null,null,null,null,null,null,null
Bhutan,Asia,Southern Asia,null,null,21.34,16.06,21.79,11.99,12.9,null
Bolivia,Latin America and the Caribbean,South America,5.07,7.29,12.48,18.47,27.06,22.6,26.23,42.45
Bosnia and Herzegovina,Europe,Southern Europe,18.6,20.47,25.16,34.43,43.1,22.98,24.47,30.74
Botswana,Africa,Southern Africa,null,7.29,8.37,8.81,10.35,6.97,8.26,8.53
Brazil,Latin America and the Caribbean,South America,17.26,24.89,42.47,66.73,108.88,94.36,126.89,170.42
Brunei,Asia,SouthEastern Asia,14.72,17.27,20.51,null,33.94,41.79,49.52,77.75
Bulgaria,Europe,Eastern Europe,43.11,43.26,null,60.83,79.19,57.23,67.47,77.6
Burkina Faso,Africa,Western Africa,null,null,7.11,11.05,25.52,40.01,42.8,45.8
Burundi,Africa,Eastern Africa,null,null,8.38,7.89,9.72,5.07,5.43,null
Cambodia,Asia,SouthEastern Asia,10.9,14.41,18.64,23.63,25.82,19.47,23.81,45.52
Cameroon,Africa,Middle Africa,null,null,9.01,10.27,16.6,6.79,9.83,9.94
Canada,Northern America,Northern America,63.72,80.14,116.86,140.4,176.46,111.76,153.39,188.2
Cape Verde,Africa,Western Africa,null,null,25.9,20.85,23.78,14.11,17.39,10.7
Chile,Latin America and the Caribbean,South America,31,51.6,85.05,128.95,209.83,211.43,240.43,265.62
China,Asia,Eastern Asia,57.03,77.33,91.88,139.76,193.15,178.73,200.53,189.49
Colombia,Latin America and the Caribbean,South America,10.63,14.93,23.28,36.63,68.44,84.66,99.19,144.98
Congo,Africa,Middle Africa,null,null,17.85,16.2,24.12,27.94,43.73,35.94
Costa Rica,Latin America and the Caribbean,Central America,8.03,12.73,23.91,37.72,57.27,57.73,79.9,96.65
Croatia,Europe,Southern Europe,22.54,23.15,29.27,37.2,55.36,31.09,36.82,50.69
Cuba,Latin America and the Caribbean,Caribbean,null,null,12.12,5.09,3.46,1.92,1.95,null
Curaçao,Latin America and the Caribbean,Caribbean,18.87,null,null,null,null,null,null,null
Cyprus,Asia,Western Asia,16.76,19.18,24.66,30.59,50.45,33.44,59.62,86.1
Czechia,Europe,Eastern Europe,34.63,40.58,52.8,67.49,86.29,48.15,60.35,69.55
Côte d'Ivoire,Africa,Western Africa,6.94,10.64,14.6,22.84,35.41,30.15,57.72,62.04
Denmark,Europe,Northern Europe,69.92,82.16,102.88,151.23,216.13,156.06,199.5,219.23
Djibouti,Africa,Eastern Africa,null,null,10.6,13.48,17.75,8.27,22.42,17.08
Dominica,Latin America and the Caribbean,Caribbean,null,null,25.99,31.2,34.42,69.57,86.66,93.74
Dominican Republic,Latin America and the Caribbean,Caribbean,13.07,14.57,34.58,25.99,31.85,17.03,26.87,36.1
DR Congo,Africa,Middle Africa,null,null,7.55,9.82,11.46,9.95,11.91,38.03
East Timor,Asia,SouthEastern Asia,null,null,5.06,null,null,4.83,4.38,null
Ecuador,Latin America and the Caribbean,South America,10.02,12.65,18.62,26.83,37.53,43.19,68.95,93.79
Egypt,Africa,Northern Africa,5.28,5.76,9.78,31.38,44.09,45.46,54.32,76.48
El Salvador,Latin America and the Caribbean,Central America,6.82,8.17,11.89,16.18,26.41,26.03,48.94,55.77
Equatorial Guinea,Africa,Middle Africa,null,null,null,null,12.17,6.29,null,null
Estonia,Europe,Northern Europe,35.66,41.31,59.91,71.21,82.82,51.35,67.69,80.14
Ethiopia,Africa,Eastern Africa,null,9.39,11.61,8.72,14.44,4.06,5.88,9.48
Fiji,Oceania,Melanesia,null,null,17.24,19.47,21.28,13.98,16.64,26.36
Finland,Europe,Northern Europe,39.1,48.83,72.88,101.92,131.02,92.12,97.75,114.33
France,Europe,Western Europe,60.83,81.45,106.96,158.44,201.61,105.23,169.65,223.72
Gabon,Africa,Middle Africa,null,null,23.18,20.88,20.62,40.58,34.2,41.42
Gambia,Africa,Western Africa,null,null,8.96,7.79,10.09,5.92,7.23,null
Georgia,Asia,Western Asia,17.76,17.15,24.38,26.91,26.73,24.72,25.4,34.4
Germany,Europe,Western Europe,50.02,57.61,74.33,106.41,130.76,75.09,85,90.63
Ghana,Africa,Western Africa,15.6,24.9,20.04,46.65,49.55,24.59,35.42,37.8
Greece,Europe,Southern Europe,13.77,16.85,22.16,28.91,35.03,32.29,38.82,47.03
Grenada,Latin America and the Caribbean,Caribbean,null,null,36.35,48.84,56.44,58.08,81.18,null
Guam,Oceania,Micronesia,24.89,null,null,null,null,null,null,null
Guatemala,Latin America and the Caribbean,Central America,8.86,8.27,11.75,14.96,23.82,25.52,43.81,52.32
Guinea,Africa,Western Africa,null,null,null,13.88,null,5.91,10.11,9.35
Guyana,Latin America and the Caribbean,South America,7.73,18.74,19.71,25.19,63.2,50.93,59.37,90.78
Haiti,Latin America and the Caribbean,Caribbean,null,null,9.7,13.09,14.93,15,33.87,41.57
Honduras,Latin America and the Caribbean,Central America,6.24,7.39,12.92,17.71,26.17,28.56,37.42,50.52
Hong Kong (SAR),Asia,Eastern Asia,145.17,139.58,161.17,205.69,254.4,179.58,243.59,280
Hungary,Europe,Eastern Europe,73.66,99.2,119.61,156.66,201.55,101.08,134.08,174.95
Iceland,Europe,Northern Europe,127.11,147.13,null,null,null,null,173.45,213.98
India,Asia,Southern Asia,18.33,24.56,31.59,43.04,62.45,48.29,54.17,63.79
Indonesia,Asia,SouthEastern Asia,13.2,15.37,20.61,22.53,26.95,22.35,28.28,32.06
Iran,Asia,Southern Asia,9.94,12.4,12.97,20.58,21.35,10.02,11.92,14.81
Iraq,Asia,Western Asia,7.28,12.56,19.54,27.82,33.13,20.14,27.32,33.35
Ireland,Europe,Northern Europe,38.43,51.93,71.65,86.41,117.4,70.49,91.25,133.34
Israel,Asia,Western Asia,41.22,63.87,76.6,111.32,164.24,94.68,159.29,206.42
Italy,Europe,Southern Europe,26.89,36.48,50.54,66.1,94.3,48.78,59.91,78.42
Jamaica,Latin America and the Caribbean,Caribbean,20.28,20.9,21.12,35.75,40,40.83,60.85,76.44
Japan,Asia,Eastern Asia,69.87,81.47,100.01,127.09,180.35,131.86,143.18,197.78
Jersey,Europe,Northern Europe,64.77,null,null,null,null,null,null,null
Jordan,Asia,Western Asia,14.15,23.76,39.25,59.97,82.44,70.44,96.98,150.88
Kazakhstan,Asia,Central Asia,26.19,28.07,38.29,47.43,61.05,38.22,47.01,58.81
Kenya,Africa,Eastern Africa,15.18,14.82,15.5,15.23,17.41,8.98,10.38,11.59
Kosovo,Europe,Southern Europe,null,null,36.69,48.68,60.86,45.81,54.64,69.35
Kuwait,Asia,Western Asia,14.65,20.35,29.87,113.12,141.42,114.17,151.94,188.29
Kyrgyzstan,Asia,Central Asia,16.22,17.84,25.99,42.29,47.91,48.46,52.77,65.44
Laos,Asia,SouthEastern Asia,8.74,17.21,18.75,31.53,47.01,27.92,31.83,38.8
Latvia,Europe,Northern Europe,46.73,48.74,85.41,107.03,133.91,61.62,70.97,92.62
Lebanon,Asia,Western Asia,4.45,6.06,6.84,10.24,16.9,6.72,7.58,17.38
Lesotho,Africa,Southern Africa,null,null,null,null,25.59,16.95,20.57,null
Liberia,Africa,Western Africa,null,null,21.64,18.26,25.65,7.98,6.35,8.9
Libya,Africa,Northern Africa,3.45,8.12,9.38,10.91,16.53,8.06,8.68,11.1
Liechtenstein,Europe,Western Europe,null,null,112.5,164.47,194.77,110.77,135.28,186.36
Lithuania,Europe,Northern Europe,72.46,65.55,93.23,117.13,135.65,87.21,94.5,119.59
Luxembourg,Europe,Western Europe,59.96,96.96,107.86,135.48,173.16,93.22,102.2,142.05
Macau (SAR),Asia,Eastern Asia,87.63,92.05,114.18,151.86,170.84,157.54,158.27,162.24
Madagascar,Africa,Eastern Africa,null,null,32.94,33.61,45.98,24.7,29.81,27.41
Malawi,Africa,Eastern Africa,null,null,11.17,11.16,13.72,8.87,13.61,null
Malaysia,Asia,SouthEastern Asia,20.74,31.32,74.87,87.9,103.28,85.08,98.48,131.03
Maldives,Asia,Southern Asia,11.86,10.84,14.3,21.95,23.72,9.69,12.78,13.27
Mali,Africa,Western Africa,null,null,12.15,17.99,19.99,22.76,20,null
Malta,Europe,Southern Europe,41.6,51.23,90.62,110.67,142.07,87.36,106.58,116.51
Marshall Islands,Oceania,Micronesia,null,null,null,null,42.6,null,null,null
Mauritania,Africa,Western Africa,null,null,3.97,5.5,11.08,14.56,21.3,19.3
Mauritius,Africa,Eastern Africa,13.4,13.78,19.08,19.8,23.87,25.08,36.18,51.61
Mexico,Latin America and the Caribbean,Central America,19.2,22.4,31.86,42.27,53.04,48.45,61.37,79.31
Micronesia,Oceania,Micronesia,null,null,null,null,16.56,10.24,10.81,null
Moldova,Europe,Eastern Europe,39.76,44.54,50.33,81.11,139.61,104.92,105.92,120.73
Monaco,Europe,Western Europe,null,null,124.4,164.31,242.89,126.72,156.76,null
Mongolia,Asia,Eastern Asia,20.01,23.27,28.97,43.62,50.52,50.85,58.57,71.45
Montenegro,Europe,Southern Europe,20.28,24.11,29.75,47.17,47.39,38.26,47.26,61.13
Morocco,Africa,Northern Africa,12.51,12.91,17.38,19.01,26.4,15.19,20.29,29.57
Mozambique,Africa,Eastern Africa,null,6.36,7.21,8.61,8.84,5.81,10.37,16.48
Myanmar (Burma),Asia,SouthEastern Asia,8.39,8.36,17.43,20.87,19.78,19.05,19.56,21.56
Namibia,Africa,Southern Africa,10.17,10.77,12.77,14.63,18.16,7.69,13.41,14.73
Nepal,Asia,Southern Asia,13.32,18.42,20.71,21.91,30.49,47.45,60.25,71.62
Netherlands,Europe,Western Europe,71.95,83.32,99.81,120.46,161.85,106.51,136.34,186.84
New Zealand,Oceania,Australia and New Zealand,64.32,81.85,101.31,129.97,164.16,133.44,167.56,178.8
Nicaragua,Latin America and the Caribbean,Central America,5.62,6.71,8.02,17.36,30.26,41.15,51.22,59.51
Niger,Africa,Western Africa,null,null,null,null,null,4.23,5.23,null
Nigeria,Africa,Western Africa,9.13,10.18,11.7,12.61,18.15,9.7,16.39,21.59
North Macedonia,Europe,Southern Europe,21.38,23.1,27.59,31.26,38.84,27.3,37.12,42.26
Norway,Europe,Northern Europe,67.8,83.63,107.27,137.72,161.61,100.89,109.59,129
Oman,Asia,Western Asia,14,18.47,24.34,36.63,65.3,55.05,64.2,72.64
Pakistan,Asia,Southern Asia,6.05,7.53,8.79,9.56,13.5,10.18,11.85,15.52
Palestine,Asia,Western Asia,9.43,9.06,13.48,15.52,25.02,51.63,64.78,68.16
Panama,Latin America and the Caribbean,Central America,29.32,34.24,76.09,98.59,131.35,107.86,147.32,151.94
Papua New Guinea,Oceania,Melanesia,null,null,9.11,13.08,16.4,9.57,12.06,null
Paraguay,Latin America and the Caribbean,South America,7.67,56.33,58.83,39.99,72.94,63.51,78.05,92.67
Peru,Latin America and the Caribbean,South America,14.18,23.71,28.65,35.31,57.97,53.98,89.34,166.89
Philippines,Asia,SouthEastern Asia,13.41,17.57,23.65,25.34,72.56,78.33,88.81,94.43
Poland,Europe,Eastern Europe,38.75,49.04,81.81,106.52,147.45,91.24,109.01,154.51
Portugal,Europe,Southern Europe,48.52,64.2,87.25,117.44,145.96,100.32,126.09,172.13
Puerto Rico,Latin America and the Caribbean,Caribbean,31.06,null,null,null,null,null,null,null
Qatar,Asia,Western Asia,28.26,32.79,69.01,90.8,109.57,86.88,153.89,173.33
Reunion,Africa,Eastern Africa,40.24,null,null,null,null,null,null,null
Romania,Europe,Eastern Europe,98.39,107.42,131.22,175.39,217.91,123.31,160.32,200.94
Russia,Europe,Eastern Europe,36.77,39.72,56.42,75.91,93.37,71.86,80.52,88.08
Rwanda,Africa,Eastern Africa,null,null,12.71,22,18.45,9.48,33.08,30.5
Saint Kitts and Nevis,Latin America and the Caribbean,Caribbean,null,null,21.53,25.52,32.78,29.76,49.53,null
Saint Lucia,Latin America and the Caribbean,Caribbean,null,null,19.63,37.39,49.5,76.66,85.59,94.01
Saint Vincent and the Grenadines,Latin America and the Caribbean,Caribbean,null,null,38.62,43.21,50.8,69.54,84.01,null
San Marino,Europe,Southern Europe,null,null,60.95,97.48,114.24,59.45,69.25,94.78
Saudi Arabia,Asia,Western Asia,16.28,24.92,42.92,70.54,91.65,83.35,95.13,112.24
Senegal,Africa,Western Africa,null,8.13,18.01,21.27,34.68,20.7,23.21,21.65
Serbia,Europe,Southern Europe,23.78,31.95,46.73,64.52,80.59,53.72,65.13,82.28
Seychelles,Africa,Eastern Africa,null,null,25.67,34.64,33.27,31.78,29.67,null
Sierra Leone,Africa,Western Africa,null,null,8.16,11.69,12.13,10.46,13.95,24.72
Singapore,Asia,SouthEastern Asia,156.67,189.38,193.9,218.07,262.2,219.01,254.65,297.57
Slovakia,Europe,Eastern Europe,37.9,44.37,56.76,84.79,106.12,51.89,67.76,81.08
Slovenia,Europe,Southern Europe,33.05,40.8,60.14,78.52,111.74,69.64,81.99,92.98
Somalia,Africa,Eastern Africa,null,null,12.56,17.88,14.66,7.47,9.29,16.76
South Africa,Africa,Southern Africa,null,null,23.89,33.98,53.6,36.11,43.45,47.35
South Korea,Asia,Eastern Asia,121.49,103.51,160,159.98,216.67,109.1,119.58,157.63
Spain,Europe,Southern Europe,61.92,87.74,106.2,145.73,187.36,131.55,176.74,205.17
Sri Lanka,Asia,Southern Asia,19.18,21.16,26.51,30.35,26.05,19.53,19.67,22.94
Sudan,Africa,Northern Africa,null,null,7.88,6.26,9.02,4.6,6.5,null
Suriname,Latin America and the Caribbean,South America,null,7.9,10.64,11.39,14.93,11.59,11.33,12.09
Swaziland,Africa,Southern Africa,null,null,14.22,13.25,10.62,5.23,7.79,null
Sweden,Europe,Northern Europe,78.1,91.86,117.33,150.73,167.29,98.45,107.2,138.62
Switzerland,Europe,Western Europe,76.84,94.56,119.33,170.67,222,122.76,160.81,203.5
Syria,Asia,Western Asia,6.47,7.74,7.79,8.25,10.73,3.06,4.32,3.65
Taiwan,Asia,Eastern Asia,44.23,58.63,129.43,125.46,152,115.07,156.97,198.28
Tajikistan,Asia,Central Asia,null,null,19.05,32.61,33.85,31.78,20.96,29.26
Tanzania,Africa,Eastern Africa,8.76,11.61,13.1,14.96,17.93,11.12,16.49,18.61
Thailand,Asia,SouthEastern Asia,37.45,50.99,88.78,173.41,221,188.75,212.68,232.15
Togo,Africa,Western Africa,null,null,19.92,19.91,20.61,33.72,26.47,30.68
Trinidad and Tobago,Latin America and the Caribbean,Caribbean,35.02,41.17,45.98,62,87.42,77.74,100.2,119.78
Tunisia,Africa,Northern Africa,6.43,7.37,8.9,9.52,10.3,7.83,8.53,10.58
Turkmenistan,Asia,Central Asia,null,null,2.12,3.56,4.49,2.18,4.69,3.53
Türkiye,Asia,Western Asia,15.55,16.26,22.33,27.95,40.58,29.43,34.61,42.9
Uganda,Africa,Eastern Africa,6.7,null,16.36,12.11,14.62,10.01,11.69,17.09
Ukraine,Europe,Eastern Europe,35.42,37.47,47.72,59.13,73.89,55.32,69.92,81.84
United Arab Emirates,Asia,Western Asia,25.13,30.81,83.28,119.14,195.11,127.16,240.25,297.62
United Kingdom,Europe,Northern Europe,49.85,53.17,61.92,72.36,95.79,66.22,77.61,108.61
United States,Northern America,Northern America,74.99,100.07,120,156.61,199,167.36,210.4,242.27
Uruguay,Latin America and the Caribbean,South America,20.97,35.58,45.62,53.57,61.23,94.6,144.28,156.02
Uzbekistan,Asia,Central Asia,5.78,7.98,18.49,29.8,40.64,41.84,51.95,69.37
Vanuatu,Oceania,Melanesia,null,null,4.55,null,15.44,7.89,10.06,null
Venezuela,Latin America and the Caribbean,South America,3.42,4.13,3.53,6.15,22.33,11.1,29.51,59.81
Vietnam,Asia,SouthEastern Asia,24.43,25.61,39.62,55.20,75.3,80.28,93.11,151.69
Western Sahara,Oceania,Melanesia,null,null,14.95,20.12,23.84,14.01,20.91,null
Yemen,Asia,Western Asia,null,null,2.63,4.35,5.95,2.72,5.28,7.54
Zambia,Africa,Eastern Africa,null,null,12.58,14.14,10.69,7,12.16,18.2
Zimbabwe,Africa,Eastern Africa,9.49,null,12.77,14.74,14.86,6.79,8.98,21.81

/* =======================
   file: src/main.jsx
   ======================= */
import React from 'react'
import { createRoot } from 'react-dom/client'
import App from './App'
import './styles.css'

createRoot(document.getElementById('root')).render(<App />)

/* =======================
   file: src/styles.css
   ======================= */
@tailwind base;
@tailwind components;
@tailwind utilities;

html, body, #root { height: 100%; }

/* =======================
   file: src/utils/parseCSV.js
   ======================= */
import Papa from 'papaparse'

export function parseCSVText(csvText) {
  return new Promise((resolve, reject) => {
    Papa.parse(csvText, {
      header: true,
      dynamicTyping: true,
      skipEmptyLines: true,
      complete: (results) => resolve(results.data),
      error: (err) => reject(err),
    })
  })
}

export async function fetchAndParseCSV(url = '/data.csv') {
  const res = await fetch(url)
  if (!res.ok) throw new Error('Failed to fetch CSV: ' + res.status)
  const text = await res.text()
  return parseCSVText(text)
}

/* =======================
   file: src/utils/userProgram.js
   ======================= */
// This user's program analyzes the parsed CSV array and returns rich objects used
// by the React app: stats, preview, series, topCountries, regionSums, growths, points.

export default async function analyze(data) {
  // data: array of objects where year keys are like 'year 2017'
  const years = Object.keys(data[0] || {}).filter(k => k.startsWith('year')).sort()
  const toNum = v => (v === null || v === undefined || v === '' || String(v).toLowerCase() === 'null') ? NaN : Number(v)

  // Compute per-country latest value (most recent year with numeric value)
  const countries = data.map(row => {
    const vals = {}
    years.forEach(y => vals[y] = toNum(row[y]))
    const latestYear = [...years].reverse().find(y => !Number.isNaN(vals[y]))
    const latest = latestYear ? vals[latestYear] : NaN
    const firstYear = years.find(y => !Number.isNaN(vals[y]))
    const first = firstYear ? vals[firstYear] : NaN
    // growth percent from first -> latest
    const growthPct = (!Number.isNaN(first) && !Number.isNaN(latest) && first !== 0) ? ((latest - first) / Math.abs(first)) * 100 : null
    return {
      country: row.country,
      major_area: row.major_area,
      region: row.region,
      values: vals,
      latestYear,
      latest: Number.isNaN(latest) ? null : latest,
      firstYear: firstYear || null,
      first: Number.isNaN(first) ? null : first,
      growthPct
    }
  })

  // Stats: numeric summary per year and overall
  const yearStats = {}
  years.forEach(y => {
    const vals = countries.map(c => c.values[y]).filter(v => !Number.isNaN(v))
    const n = vals.length
    const sum = vals.reduce((s,x)=>s+x,0)
    const mean = n? sum/n : null
    const min = n? Math.min(...vals) : null
    const max = n? Math.max(...vals) : null
    yearStats[y] = { n, sum, mean, min, max }
  })

  // Top countries by latest value
  const topCountries = [...countries].filter(c=>c.latest!=null).sort((a,b)=>b.latest-a.latest).slice(0,12)

  // Region aggregates per year
  const regionSums = {}
  countries.forEach(c => {
    const r = c.region || c.major_area || 'Unknown'
    regionSums[r] = regionSums[r] || {}
    years.forEach(y => {
      regionSums[r][y] = (regionSums[r][y] || 0) + (Number.isNaN(c.values[y])?0:c.values[y])
    })
  })

  // Global series: total per year
  const globalSeries = years.map(y=>({ year: y, value: Object.values(regionSums).reduce((s,rs)=>s + (rs[y]||0),0) }))

  // Per-country series (for table/chart): use top country if exists
  const series = topCountries.length ? Object.keys(topCountries[0].values).map((y,i)=>({ index:i, year:y, value: topCountries[0].values[y] })) : []

  // Prepare globe points: random lat/lng per country but stable via simple hash
  function hashToLatLng(str){
    let h=0; for(let i=0;i<str.length;i++){h=(h<<5)-h+str.charCodeAt(i); h |= 0}
    const lat = ((h % 180)+180)-90
    const lng = ((h/2 % 360)+360)-180
    return [lat,lng]
  }

  const points = countries.filter(c=>c.latest!=null).slice(0,500).map(c => {
    const [lat,lng] = hashToLatLng(c.country)
    return { country: c.country, lat, lng, value: c.latest }
  })

  // Preview: first 12 rows raw
  const preview = data.slice(0,12)

  return {
    years,
    yearStats,
    topCountries: topCountries.map(c=>({ country: c.country, latest: c.latest, latestYear: c.latestYear, growthPct: c.growthPct })),
    regionSums,
    globalSeries,
    series,
    preview,
    points,
  }
}

/* =======================
   file: src/components/GlobeViewer.jsx
   ======================= */
import React, { useEffect, useRef } from 'react'
import Globe from 'react-globe.gl'

export default function GlobeViewer({ points = [] }) {
  const ref = useRef()

  useEffect(() => {
    if (!ref.current) return
    ref.current.controls().autoRotate = true
    ref.current.controls().autoRotateSpeed = 0.3
  }, [])

  const gData = points.map((p, i) => ({
    lat: p.lat || (Math.random() * 180 - 90),
    lng: p.lng || (Math.random() * 360 - 180),
    size: p.value || 1,
    color: p.color || 'orange',
  }))

  return (
    <div className="w-full h-96 rounded-2xl shadow-xl overflow-hidden">
      <Globe
        ref={ref}
        globeImageUrl="https://unpkg.com/three-globe/example/img/earth-dark.jpg"
        pointsData={gData}
        pointAltitude={d => Math.sqrt(d.size) * 0.01}
        pointColor={d => d.color}
        pointRadius={d => Math.sqrt(d.size) * 0.5}
      />
    </div>
  )
}

/* =======================
   file: src/App.jsx
   ======================= */
import React, { useEffect, useState, useMemo, useRef } from 'react'
import { fetchAndParseCSV } from './utils/parseCSV'
import analyzeDefault from './utils/userProgram'
import GlobeViewer from './components/GlobeViewer'
import Controls from './components/Controls'
import ChartsPanel from './components/ChartsPanel'
import CountryTable from './components/CountryTable'
import ComparePanel from './components/ComparePanel'
import TimelinePlayer from './components/TimelinePlayer'
import { motion } from 'framer-motion'

export default function App(){
  const [data, setData] = useState(null)
  const [analysis, setAnalysis] = useState(null)
  const [loading, setLoading] = useState(true)
  const [error, setError] = useState(null)

  // UI state
  const [selectedRegion, setSelectedRegion] = useState('All')
  const [selectedCountry, setSelectedCountry] = useState(null)
  const [compareCountries, setCompareCountries] = useState([])
  const [yearFocus, setYearFocus] = useState(null)
  const [minSpeedFilter, setMinSpeedFilter] = useState(null)

  useEffect(()=>{
    async function load(){
      try{
        const parsed = await fetchAndParseCSV('/data.csv')
        setData(parsed)
        // run analysis
        let result = null
        try{
          const mod = await import('./utils/userProgram')
          result = await (mod.default || analyzeDefault)(parsed)
        }catch(e){
          result = await analyzeDefault(parsed)
        }
        setAnalysis(result)
        setYearFocus(result.years ? result.years[result.years.length-1] : null)
      }catch(e){
        setError(e.message)
      }finally{setLoading(false)}
    }
    load()
  },[])

  // Derived lists
  const regions = useMemo(()=>{
    if(!data) return []
    const set = new Set(data.map(r=>r.region).filter(Boolean))
    return ['All', ...Array.from(set).sort()]
  },[data])

  const countries = useMemo(()=> data? data.map(r=>r.country).sort() : [], [data])

  // Filtered points for globe and table
  const filtered = useMemo(()=>{
    if(!analysis) return { points: [], topCountries: [], regionSums: {} }
    let pts = analysis.points || []
    if(selectedRegion && selectedRegion !== 'All'){
      // filter by region by looking into data
      const regionSet = new Set(data.filter(d=>d.region===selectedRegion).map(d=>d.country))
      pts = pts.filter(p=>regionSet.has(p.country))
    }
    if(minSpeedFilter != null){ pts = pts.filter(p=>p.value >= minSpeedFilter) }
    return { points: pts, topCountries: analysis.topCountries, regionSums: analysis.regionSums }
  }, [analysis, selectedRegion, minSpeedFilter, data])

  function handleCountryClick(name){
    setSelectedCountry(name)
    if(!compareCountries.includes(name)) setCompareCountries(prev=>prev.slice(0,4).concat(name))
  }

  if(loading) return <div className="min-h-screen flex items-center justify-center">Loading dataset...</div>
  if(error) return <div className="min-h-screen flex items-center justify-center text-red-500">Error: {error}</div>

  return (
    <div className="min-h-screen bg-gradient-to-b from-slate-900 to-slate-800 text-slate-100 p-6">
      <header className="max-w-8xl mx-auto flex items-center justify-between mb-6">
        <h1 className="text-3xl font-extrabold">Global Internet Speed Explorer</h1>
        <div className="text-sm opacity-80">Interactive globe + deep analytics — powered by your program.</div>
      </header>

      <main className="max-w-8xl mx-auto grid grid-cols-1 lg:grid-cols-4 gap-6">
        <div className="lg:col-span-3 space-y-4">
          <motion.div className="p-4 rounded-2xl bg-slate-900 shadow-2xl" initial={{ opacity:0, y:10 }} animate={{ opacity:1, y:0 }}>
            <div className="grid grid-cols-1 lg:grid-cols-3 gap-4">
              <div className="col-span-2">
                <GlobeViewer points={filtered.points} onCountryClick={handleCountryClick} highlightCountry={selectedCountry} yearFocus={yearFocus} />
              </div>
              <div className="space-y-3">
                <Controls
                  years={analysis.years}
                  regions={regions}
                  selectedRegion={selectedRegion}
                  setSelectedRegion={setSelectedRegion}
                  countries={countries}
                  selectedCountry={selectedCountry}
                  setSelectedCountry={setSelectedCountry}
                  minSpeedFilter={minSpeedFilter}
                  setMinSpeedFilter={setMinSpeedFilter}
                  yearFocus={yearFocus}
                  setYearFocus={setYearFocus}
                />
                <ComparePanel countries={countries} compare={compareCountries} setCompare={setCompareCountries} data={data} analysis={analysis} />
                <TimelinePlayer years={analysis.years} onFrame={y=>setYearFocus(y)} />
              </div>
            </div>
          </motion.div>

          <ChartsPanel analysis={analysis} selectedRegion={selectedRegion} selectedCountry={selectedCountry} compareCountries={compareCountries} yearFocus={yearFocus} onCountryClick={handleCountryClick} />

          <motion.div className="p-4 rounded-2xl bg-slate-900 shadow-2xl" initial={{ opacity:0, y:10 }} animate={{ opacity:1, y:0 }}>
            <h3 className="font-semibold">Raw Analysis Output (JSON)</h3>
            <pre className="text-xs mt-2 max-h-64 overflow-auto bg-slate-800 p-3 rounded">{JSON.stringify(analysis, null, 2)}</pre>
          </motion.div>
        </div>

        <aside className="space-y-4">
          <CountryTable data={data} analysis={analysis} onSelectCountry={c=>setSelectedCountry(c)} regionFilter={selectedRegion} minSpeed={minSpeedFilter} />

          <div className="p-4 rounded-2xl bg-slate-900">
            <h3 className="font-medium">Export & Deploy</h3>
            <p className="text-sm mt-2">You can export filtered data or download charts. Deploy instructions are in the README.</p>
            <div className="mt-3 flex gap-2">
              <button className="px-3 py-2 rounded bg-indigo-600" onClick={()=>{ // export filtered points
                const csv = ['country,lat,lng,value', ...filtered.points.map(p=>`${p.country},${p.lat},${p.lng},${p.value}`)].join('
')
                const blob = new Blob([csv], { type: 'text/csv' })
                const url = URL.createObjectURL(blob)
                const a = document.createElement('a'); a.href = url; a.download = 'filtered_points.csv'; a.click();
              }}>Download Points CSV</button>
              <button className="px-3 py-2 rounded bg-slate-700" onClick={()=>alert('Connect to GitHub: push repo and enable Vercel/Netlify deploy')}>Deploy</button>
            </div>
          </div>

        </aside>
      </main>

      <footer className="max-w-8xl mx-auto mt-8 text-sm opacity-70">Built for exploration — click a country on the globe, filter by region, compare countries, and play the timeline. Want screenshots and a GitHub repo? I can generate them.</footer>
    </div>
  )
}

/* =======================
   file: src/components/Controls.jsx
   ======================= */
import React from 'react'

export default function Controls({ years, regions, selectedRegion, setSelectedRegion, countries, selectedCountry, setSelectedCountry, minSpeedFilter, setMinSpeedFilter, yearFocus, setYearFocus }){
  return (
    <div className="p-3 bg-slate-800 rounded-lg">
      <h4 className="font-semibold">Controls</h4>
      <div className="mt-2 text-sm space-y-2">
        <div>
          <label className="block text-xs">Region</label>
          <select className="w-full bg-slate-700 p-2 rounded" value={selectedRegion} onChange={e=>setSelectedRegion(e.target.value)}>
            {regions.map(r=> <option key={r} value={r}>{r}</option> )}
          </select>
        </div>
        <div>
          <label className="block text-xs">Country (quick select)</label>
          <select className="w-full bg-slate-700 p-2 rounded" value={selectedCountry||''} onChange={e=>setSelectedCountry(e.target.value||null)}>
            <option value="">— none —</option>
            {countries.map(c=> <option key={c} value={c}>{c}</option>)}
          </select>
        </div>
        <div>
          <label className="block text-xs">Min speed filter (Mbps)</label>
          <input type="number" className="w-full bg-slate-700 p-2 rounded" value={minSpeedFilter||''} onChange={e=>setMinSpeedFilter(e.target.value?Number(e.target.value):null)} />
        </div>
        <div>
          <label className="block text-xs">Year focus</label>
          <select className="w-full bg-slate-700 p-2 rounded" value={yearFocus||''} onChange={e=>setYearFocus(e.target.value)}>
            {years.map(y=> <option key={y} value={y}>{y.replace('year ','')}</option>)}
          </select>
        </div>
      </div>
    </div>
  )
}

/* =======================
   file: src/components/ChartsPanel.jsx
   ======================= */
import React from 'react'
import { ResponsiveContainer, LineChart, Line, XAxis, YAxis, Tooltip, BarChart, Bar, CartesianGrid, Legend, PieChart, Pie, Cell } from 'recharts'

export default function ChartsPanel({ analysis, selectedRegion, selectedCountry, compareCountries, yearFocus, onCountryClick }){
  if(!analysis) return null
  const { globalSeries, topCountries, regionSums } = analysis

  // prepare region breakdown for selected year
  const year = yearFocus
  const regionData = Object.keys(regionSums || {}).map(r => ({ region: r, value: (regionSums[r][year] || 0) }))
  regionData.sort((a,b)=>b.value-a.value)

  const topBars = topCountries || []

  const colors = ['#8884d8','#82ca9d','#ffc658','#ff7f50','#a4de6c','#d0ed57','#8dd1e1']

  return (
    <div className="space-y-4">
      <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
        <div className="p-4 rounded-2xl bg-slate-900 shadow">
          <h3 className="font-semibold">Global Total Over Time</h3>
          <div className="h-48 mt-3">
            <ResponsiveContainer width="100%" height="100%">
              <LineChart data={globalSeries}>
                <XAxis dataKey="year" tickFormatter={y=>y.replace('year ','')}/>
                <YAxis />
                <Tooltip formatter={(v)=>v && v.toFixed? v.toFixed(2):v} />
                <Line type="monotone" dataKey="value" stroke="#82ca9d" dot={false} />
              </LineChart>
            </ResponsiveContainer>
          </div>
        </div>

        <div className="p-4 rounded-2xl bg-slate-900 shadow">
          <h3 className="font-semibold">Regional Breakdown ({year.replace('year ','')})</h3>
          <div className="h-48 mt-3">
            <ResponsiveContainer width="100%" height="100%">
              <BarChart data={regionData} layout="vertical">
                <XAxis type="number" />
                <YAxis dataKey="region" type="category" width={120} />
                <Tooltip />
                <Bar dataKey="value">
                  {regionData.map((entry, index) => <Cell key={`cell-${index}`} fill={colors[index%colors.length]} />)}
                </Bar>
              </BarChart>
            </ResponsiveContainer>
          </div>
        </div>
      </div>

      <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
        <div className="p-4 rounded-2xl bg-slate-900 shadow">
          <h3 className="font-semibold">Top Countries (latest)</h3>
          <div className="mt-3">
            <ResponsiveContainer width="100%" height={220}>
              <BarChart data={topBars} layout="vertical">
                <XAxis type="number" />
                <YAxis dataKey="country" type="category" width={120} />
                <Tooltip />
                <Bar dataKey="latest" fill="#8884d8" />
              </BarChart>
            </ResponsiveContainer>
          </div>
        </div>

        <div className="p-4 rounded-2xl bg-slate-900 shadow">
          <h3 className="font-semibold">DII Distribution (by country)</h3>
          <div className="h-48 mt-3 text-xs overflow-auto">(Histogram / boxplot placeholder — compute from analysis on demand)</div>
        </div>

        <div className="p-4 rounded-2xl bg-slate-900 shadow">
          <h3 className="font-semibold">Country Comparison</h3>
          <div className="mt-3 text-xs">Selected: {selectedCountry || '—'} | Comparisons: {compareCountries.join(', ')}</div>
        </div>
      </div>
    </div>
  )
}

/* =======================
   file: src/components/CountryTable.jsx
   ======================= */
import React, { useMemo } from 'react'

export default function CountryTable({ data, analysis, onSelectCountry, regionFilter, minSpeed }){
  const rows = useMemo(()=>{
    if(!data) return []
    return data.filter(d=> {
      if(regionFilter && regionFilter !== 'All' && d.region !== regionFilter) return false
      // parse 2024
      const v = d['year 2024']
      if(minSpeed != null){ const num = Number(v); if(Number.isNaN(num) || num < minSpeed) return false }
      return true
    }).map(d=>({ country: d.country, region: d.region, major_area: d.major_area, y2023: d['year 2023'], y2024: d['year 2024'] }))
  }, [data, regionFilter, minSpeed])

  return (
    <div className="p-4 rounded-2xl bg-slate-900">
      <h3 className="font-medium">Countries</h3>
      <div className="mt-2 text-xs max-h-96 overflow-auto">
        <table className="table-auto w-full text-left text-xs">
          <thead>
            <tr><th className="pr-2">Country</th><th>Region</th><th>2023</th><th>2024</th></tr>
          </thead>
          <tbody>
            {rows.map((r,i)=> (
              <tr key={i} className={i%2? 'bg-slate-800':''} onClick={()=>onSelectCountry(r.country)} style={{cursor:'pointer'}}>
                <td className="pr-2">{r.country}</td>
                <td>{r.region}</td>
                <td>{r.y2023}</td>
                <td>{r.y2024}</td>
              </tr>
            ))}
          </tbody>
        </table>
      </div>
    </div>
  )
}

/* =======================
   file: src/components/ComparePanel.jsx
   ======================= */
import React from 'react'

export default function ComparePanel({ countries, compare, setCompare, data, analysis }){
  function toggle(c){
    if(compare.includes(c)) setCompare(compare.filter(x=>x!==c))
    else setCompare(prev => prev.slice(0,3).concat(c))
  }

  return (
    <div className="p-3 bg-slate-800 rounded-lg text-sm">
      <h4 className="font-semibold">Compare Countries</h4>
      <div className="mt-2 grid grid-cols-2 gap-2 max-h-40 overflow-auto">
        {countries.slice(0,200).map(c=> (
          <button key={c} className={`text-xs p-1 rounded ${compare.includes(c)? 'bg-indigo-600':'bg-slate-700'}`} onClick={()=>toggle(c)}>{c}</button>
        ))}
      </div>
      <div className="mt-2 text-xs">Select up to 4 countries to compare. Clicking a country on the globe adds it here.</div>
    </div>
  )
}

/* =======================
   file: src/components/TimelinePlayer.jsx
   ======================= */
import React, { useState, useRef } from 'react'

export default function TimelinePlayer({ years, onFrame }){
  const [playing, setPlaying] = useState(false)
  const idxRef = useRef(0)
  const timerRef = useRef(null)

  function play(){
    if(playing){ setPlaying(false); clearInterval(timerRef.current); return }
    setPlaying(true)
    idxRef.current = 0
    timerRef.current = setInterval(()=>{
      const y = years[idxRef.current]
      onFrame(y)
      idxRef.current = (idxRef.current+1) % years.length
    }, 900)
  }

  return (
    <div className="p-3 bg-slate-800 rounded-lg text-sm">
      <h4 className="font-semibold">Timeline Player</h4>
      <div className="mt-2 flex gap-2">
        <button className="px-3 py-2 rounded bg-indigo-600" onClick={play}>{playing? 'Stop':'Play'}</button>
        <button className="px-3 py-2 rounded bg-slate-700" onClick={()=>{ idxRef.current = 0; onFrame(years[0]) }}>Reset</button>
      </div>
    </div>
  )
}

/* =======================
   file: index.html
   ======================= */
<!doctype html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Impressive Data Site</title>
  </head>
  <body>
    <div id="root"></div>
    <script type="module" src="/src/main.jsx"></script>
  </body>
</html>

/* =======================
   End of scaffold
   ======================= */
